version: '3.8'

services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: hiilu-backend
    restart: unless-stopped
    ports:
      - '8080:8080'
    environment:
      NODE_ENV: ${NODE_ENV:-production}
      PORT: ${PORT:-8080}
      API_PREFIX: ${API_PREFIX:-api/v1}
      # MongoDB Atlas connection
      MONGODB_URI: ${MONGODB_URI}
      # CORS - Support both local dev and production
      CORS_ORIGINS: ${CORS_ORIGINS:-http://localhost:8081,https://hilu.pics,https://www.hilu.pics}
      # JWT Configuration
      JWT_SECRET: ${JWT_SECRET}
      JWT_EXPIRATION: ${JWT_EXPIRATION:-7d}
      # Domain URLs
      BACKEND_URL: ${BACKEND_URL:-https://api.hilu.pics}
      FRONTEND_URL: ${FRONTEND_URL:-https://hilu.pics}
      NEXT_PUBLIC_APP_URL: ${NEXT_PUBLIC_APP_URL:-https://hilu.pics}
    networks:
      - hiilu-network
    healthcheck:
      test: ['CMD', 'wget', '--spider', '-q', 'http://localhost:8080/api/v1']
      interval: 30s
      timeout: 10s
      retries: 3

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: hiilu-frontend
    restart: unless-stopped
    ports:
      - '8081:8081'
    environment:
      NODE_ENV: ${NODE_ENV:-production}
      # API URL for client-side requests (from browser)
      NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL:-https://api.hilu.pics/api/v1}
      # App configuration
      NEXT_PUBLIC_APP_NAME: HiiLu
      NEXT_PUBLIC_APP_URL: ${NEXT_PUBLIC_APP_URL:-https://hilu.pics}
      # Domain URLs
      BACKEND_URL: ${BACKEND_URL:-https://api.hilu.pics}
      FRONTEND_URL: ${FRONTEND_URL:-https://hilu.pics}
    depends_on:
      - backend
    networks:
      - hiilu-network

networks:
  hiilu-network:
    driver: bridge
